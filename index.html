<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>별난별 타로카드</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #2d1b69 0%, #e9dbf2 100%);
      font-family: 'Arial', sans-serif;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      flex-direction: column;
    }

    .container {
      max-width: 900px;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    h1 {
      color: white;
      margin-bottom: 30px;
    }

    .tarot-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .card {
      width: 200px;
      height: 300px;
      perspective: 1000px;
      cursor: pointer;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 8px;
      overflow: hidden;
    }

    .card-front img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .card-back {
      background-color: #2d2a4a;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      font-size: 12.5px;
      line-height: 1.4;
      white-space: pre-line;
      box-sizing: border-box;
      transform: rotateY(180deg) scale(0.95);
      text-align: center;
      box-shadow: 0 0 20px 8px rgba(255, 255, 255, 0.2), 0 0 30px 14px rgba(255, 255, 255, 0.1) inset;
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .sub-button {
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
    }

    .sub-button:hover {
      background-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 10px 3px #fff;
      transform: translateY(-1px);
    }

    /* 공유용 캔버스는 화면에서 숨김 */
    #shareCanvas {
      position: absolute;
      left: -9999px;
      top: -9999px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>✨ 별난별 타로카드 ✨</h1> <br> 

    <div class="tarot-container">
      <div class="card" onclick="flipCard(this)" data-message="새로운 인연이 다가옵니다.&#10;마음을 열고 기다려보세요." data-image="https://i.imgur.com/HRZrNvm.png">
        <div class="card-inner">
          <div class="card-front">
            <img src="https://i.imgur.com/HRZrNvm.png" alt="카드1 앞면">
          </div>
          <div class="card-back">
            새로운 인연이 다가옵니다.
            마음을 열고 기다려보세요.
          </div>
        </div>
      </div>
      <div class="card" onclick="flipCard(this)" data-message="행운지수가 상승하였습니다!&#10;예상치 못했던 수입이 들어올 수도 있습니다." data-image="https://i.imgur.com/NMbruAt.png">
        <div class="card-inner">
          <div class="card-front">
            <img src="https://i.imgur.com/NMbruAt.png" alt="카드2 앞면">
          </div>
          <div class="card-back">
            행운지수가 상승하였습니다!
            예상치 못했던 수입이 들어올 수도 있습니다.
          </div>
        </div>
      </div>
      <div class="card" onclick="flipCard(this)" data-message="발 밑만 보며 걷다보면 예상치 못한 길로 갈 수 있습니다.&#10;멀리 보고 진행하시길!" data-image="https://i.imgur.com/OZB4t3N.png">
        <div class="card-inner">
          <div class="card-front">
            <img src="https://i.imgur.com/OZB4t3N.png" alt="카드3 앞면">
          </div>
          <div class="card-back">
            발 밑만 보며 걷다보면 예상치 못한 길로 갈 수 있습니다.
            멀리 보고 진행하시길!
          </div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button class="sub-button" onclick="goToStart()">🏠 처음으로</button>
      <button class="sub-button" onclick="sharePage()">📤 공유하기</button>
    </div>
  </div>

  <!-- 공유용 이미지 생성을 위한 숨겨진 캔버스 -->
  <canvas id="shareCanvas" width="400" height="600"></canvas>

  <script>
    let selectedCard = null;
    let selectedCardData = null;

    function flipCard(card) {
      const isFlipped = card.classList.contains('flipped');

      if (!selectedCard) {
        card.classList.toggle('flipped');
        selectedCard = card;
        selectedCardData = {
          message: card.dataset.message.replace(/&#10;/g, '\n'),
          image: card.dataset.image
        };
        disableOtherCards(card);
      } else if (card === selectedCard) {
        card.classList.toggle('flipped');
      } else {
        alert("하루에 한 번만 뽑을 수 있습니다!\n다시 뽑고 싶으시다면, 처음으로 버튼을 클릭해주세요!");
      }
    }

    function disableOtherCards(exceptCard) {
      document.querySelectorAll('.card').forEach(card => {
        if (card !== exceptCard) {
          card.onclick = () => {
            alert("하루에 한 번만 뽑을 수 있습니다.\n다시 뽑고 싶으시다면, 처음으로 버튼을 클릭해주세요!");
          };
        }
      });
    }

    function goToStart() {
      console.log("처음으로 버튼 클릭됨"); // 디버깅을 위해 추가
      window.location.href = "index.html"; // 이동하려는 페이지 URL
    }

    async function createShareImage() {
      if (!selectedCardData) return null;

      const canvas = document.getElementById('shareCanvas');
      const ctx = canvas.getContext('2d');
      
      // 배경 그라디언트
      const gradient = ctx.createLinearGradient(0, 0, 400, 600);
      gradient.addColorStop(0, '#2d1b69');
      gradient.addColorStop(1, '#e9dbf2');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 400, 600);

      // 제목
      ctx.fillStyle = 'white';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('✨ 별난별 타로카드 ✨', 200, 50);

      return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function() {
          // 카드 이미지 그리기
          const cardX = 100;
          const cardY = 80;
          const cardWidth = 200;
          const cardHeight = 300;
          
          ctx.drawImage(img, cardX, cardY, cardWidth, cardHeight);

          // 테두리
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 3;
          ctx.strokeRect(cardX, cardY, cardWidth, cardHeight);

          // 메시지 배경
          ctx.fillStyle = 'rgba(45, 42, 74, 0.9)';
          ctx.fillRect(50, 400, 300, 120);
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 2;
          ctx.strokeRect(50, 400, 300, 120);

          // 메시지 텍스트
          ctx.fillStyle = 'white';
          ctx.font = '16px Arial';
          ctx.textAlign = 'center';
          
          const lines = selectedCardData.message.split('\n');
          const lineHeight = 25;
          const startY = 430;
          
          lines.forEach((line, index) => {
            ctx.fillText(line, 200, startY + (index * lineHeight));
          });

          // 하단 텍스트
          ctx.font = '14px Arial';
          ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
          ctx.fillText('오늘의 운세를 확인해보세요!', 200, 560);

          resolve(canvas.toDataURL('image/png'));
        };
        img.src = selectedCardData.image;
      });
    }
function goToStart() {
  console.log("처음으로 버튼 클릭됨"); // 디버깅을 위해 추가
  window.location.href = "https://kimjiwoow.github.io/-/"; // 원하는 URL로 이동
}

    // 구식 브라우저용 클립보드 복사 함수
    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      
      // 화면에 보이지 않게 설정
      textArea.style.position = "fixed";
      textArea.style.top = "-1000px";
      textArea.style.left = "-1000px";
      textArea.style.width = "2em";
      textArea.style.height = "2em";
      textArea.style.padding = "0";
      textArea.style.border = "none";
      textArea.style.outline = "none";
      textArea.style.boxShadow = "none";
      textArea.style.background = "transparent";
      
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        document.body.removeChild(textArea);
        return successful;
      } catch (err) {
        document.body.removeChild(textArea);
        return false;
      }
    }

    // 클립보드 복사 함수 (모든 브라우저 호환)
    async function copyToClipboard(text) {
      // 최신 브라우저에서 navigator.clipboard 사용 시도
      if (navigator.clipboard && window.isSecureContext) {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (err) {
          console.log('navigator.clipboard 실패, fallback 시도');
          return fallbackCopyTextToClipboard(text);
        }
      } else {
        // 구식 브라우저나 비보안 컨텍스트에서 fallback 사용
        return fallbackCopyTextToClipboard(text);
      }
    }

    async function sharePage() {
      if (!selectedCardData) {
        alert('먼저 카드를 뽑아주세요!');
        return;
      }

      const shareText = `✨ 별난별 타로카드 ✨\n\n오늘의 운세:\n${selectedCardData.message}\n\n당신도 운세를 확인해보세요!\n https://kimjiwoow.github.io/-/`;


      try {
        // 공유 이미지 생성
        const shareImageUrl = await createShareImage();
        
        if (navigator.share && /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
          // 모바일에서 웹 공유 API 사용
          try {
            // 파일 공유 시도
            const response = await fetch(shareImageUrl);
            const blob = await response.blob();
            const file = new File([blob], 'tarot-result.png', { type: 'image/png' });
            
            await navigator.share({
              title: '별난별 타로카드',
              text: shareText,
              files: [file]
            });
            return;
          } catch (error) {
            // 파일 공유 실패 시 텍스트만 공유
            try {
              await navigator.share({
                title: '별난별 타로카드',
                text: shareText
              });
              return;
            } catch (textShareError) {
              console.log('웹 공유 API 실패, 클립보드 복사로 전환');
            }
          }
        }
        
        // 데스크톱이나 웹 공유 API 실패 시 클립보드 복사 + 이미지 다운로드
        const copySuccess = await copyToClipboard(shareText);
        
        if (copySuccess) {
          // 이미지 다운로드
          const link = document.createElement('a');
          link.download = 'tarot-result.png';
          link.href = shareImageUrl;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          alert('✅ 운세 내용이 클립보드에 복사되고\n이미지가 다운로드되었습니다!');
        } else {
          // 클립보드 복사도 실패한 경우
          alert('📋 복사 기능을 사용할 수 없어 텍스트를 표시합니다:\n\n' + shareText);
        }
        
      } catch (error) {
        console.error('공유 중 오류:', error);
        // 모든 방법이 실패한 경우 최후의 수단
        const copySuccess = await copyToClipboard(shareText);
        if (copySuccess) {
          alert('✅ 운세 내용이 클립보드에 복사되었습니다!');
        } else {
          alert('📋 공유 내용:\n\n' + shareText);
        }
      }
    }
    <script>
function trackClick(eventName) {
  fetch("https://script.google.com/macros/s/~~YOUR_SCRIPT_ID~~/exec", {
    method: "POST",
    body: JSON.stringify({
      event: eventName,
      ua: navigator.userAgent
    }),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(res => res.json())
  .then(data => console.log("✅ Logged:", data))
  .catch(err => console.error("❌ Logging failed:", err));
}

  </script>
</body>
</html>

